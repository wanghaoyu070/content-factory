# 内容工厂 - 决策日志

> 记录项目中的关键技术和产品决策

---

## 决策记录

### DEC-001: 登录方式选择

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 用户登录方式选择 |
| **可选方案** | A) 账号密码 B) GitHub OAuth C) 微信扫码 D) Google OAuth |
| **最终选择** | B) GitHub OAuth |
| **原因** | 1. 实现简单，NextAuth.js 原生支持<br>2. 无需自己管理密码安全<br>3. 目标用户群体（内容创作者/技术人员）普遍有 GitHub 账号<br>4. 微信需要企业资质，Google 国内不稳定 |
| **影响范围** | 登录流程、用户表设计、前端登录页面 |

---

### DEC-002: 用户注册机制

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 是否开放公开注册 |
| **可选方案** | A) 开放注册 B) 邀请码注册 C) 管理员审批注册 |
| **最终选择** | B) 邀请码注册，无需审批 |
| **原因** | 1. 控制用户增长，避免滥用<br>2. 比审批制更简单，用户体验更好<br>3. 管理员可以灵活控制邀请码发放 |
| **影响范围** | 注册流程、invite_codes 表、管理员后台 |

---

### DEC-003: 管理员指定方式

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 如何指定系统管理员 |
| **可选方案** | A) 第一个注册用户自动成为管理员 B) 手动在数据库指定 |
| **最终选择** | A) 第一个注册用户自动成为管理员 |
| **原因** | 1. 部署后无需手动操作数据库<br>2. 逻辑简单，易于理解<br>3. 第一个用户通常就是系统部署者 |
| **影响范围** | 用户注册逻辑、users 表 role 字段 |

---

### DEC-004: 右上角铃铛处理

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 右上角铃铛图标的去留 |
| **可选方案** | A) 移除 B) 保留做通知 C) 改为用户头像下拉菜单 |
| **最终选择** | C) 改为用户头像下拉菜单 |
| **原因** | 1. 铃铛目前无实际功能，保留会让用户困惑<br>2. 用户头像下拉菜单是常见设计模式<br>3. 可以放置个人设置、退出登录等功能 |
| **影响范围** | Header 组件、用户下拉菜单组件 |

---

### DEC-005: 数据库选择

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 是否更换数据库 |
| **可选方案** | A) 继续用 SQLite B) 换 PostgreSQL C) 换 MySQL |
| **最终选择** | A) 继续用 SQLite |
| **原因** | 1. 当前数据量很小（60KB），SQLite 完全够用<br>2. 部署在云服务器，SQLite 可以正常工作<br>3. 无需额外部署数据库服务，降低运维成本<br>4. 只需新增表和字段，改动最小 |
| **影响范围** | 无需更换，只需新增 users、invite_codes 表 |

---

### DEC-006: 未登录用户访问策略

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 未登录用户能否访问系统 |
| **可选方案** | A) 必须登录才能访问 B) 可浏览但不能操作 |
| **最终选择** | B) 可浏览但不能操作 |
| **原因** | 1. 降低使用门槛，用户可以先了解系统<br>2. 提高转化率，看到功能后更愿意注册<br>3. 只需在操作时检查登录状态 |
| **影响范围** | 前端访问控制、API 认证中间件 |

---

### DEC-007: 现有数据迁移策略

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 现有数据库数据如何处理 |
| **可选方案** | A) 清空重来 B) 保留并归属第一用户 |
| **最终选择** | B) 保留并归属第一用户 |
| **原因** | 1. 保留历史数据，避免丢失<br>2. 第一个用户通常是系统部署者，数据本来就是他的<br>3. 迁移逻辑简单，只需设置 user_id |
| **影响范围** | 数据迁移脚本、articles/search_records 表 |

---

### DEC-008: 管理员后台位置

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 管理员后台放在哪里 |
| **可选方案** | A) 单独 /admin 页面 B) 设置页面的标签页 |
| **最终选择** | A) 单独 /admin 页面，侧边栏不显示 |
| **原因** | 1. 管理功能与普通功能分离，更清晰<br>2. 侧边栏不显示，避免普通用户困惑<br>3. 通过用户下拉菜单访问（仅管理员可见） |
| **影响范围** | 新增 /admin 页面、用户下拉菜单 |

---

### DEC-009: 第一个用户注册方式

| 项目 | 内容 |
|------|------|
| **日期** | 2024-12-13 |
| **决策点** | 第一个用户如何注册（没有管理员生成邀请码） |
| **可选方案** | A) 第一个用户不需要邀请码 B) 系统预置种子邀请码 C) 手动数据库插入 |
| **最终选择** | A) 第一个用户不需要邀请码，直接注册成为管理员 |
| **原因** | 1. 用户体验最好，无需额外操作<br>2. 逻辑自洽：第一个用户必然是系统部署者<br>3. 实现简单，只需检查用户表是否为空 |
| **影响范围** | 注册流程、邀请码验证逻辑 |

---

## 待决策事项

| 编号 | 问题 | 状态 | 备注 |
|------|------|------|------|
| PENDING-001 | 邀请码是否需要有效期 | 待定 | v1.1 考虑 |
| PENDING-002 | 用户是否可以自己删除账号 | 待定 | 需讨论 |
| PENDING-003 | 管理员权限是否可以转让 | 待定 | 需讨论 |
| PENDING-004 | 是否需要支持多管理员 | 待定 | 当前只有一个管理员 |

---

## 变更历史

| 日期 | 变更内容 | 变更人 |
|------|----------|--------|
| 2024-12-13 | 创建决策日志，记录初始决策 | Claude |
